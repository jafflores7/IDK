{"version":3,"file":"index.umd.js","sources":["../../../../src/create-tool.ts"],"sourcesContent":["import {\n  ToolMetadata,\n  ToolInputField,\n  ToolConfigField,\n  ToolInput,\n  ToolConfig,\n  ToolDefinition,\n  ToolExecutionContext,\n  ToolExecutionResult,\n  ToolSchema,\n  ConfigurationError,\n  ValidationError,\n  Tool,\n} from '@ai-spine/tools-core';\n\n/**\n * Options for creating a new AI Spine tool.\n * This interface defines the complete configuration needed to create a functional tool.\n *\n * @template TInput - The input data type for the tool\n * @template TConfig - The configuration type for the tool\n *\n * @example\n * ```typescript\n * const options: CreateToolOptions<WeatherInput, WeatherConfig> = {\n *   metadata: {\n *     name: 'weather-tool',\n *     version: '1.0.0',\n *     description: 'Get weather information for cities',\n *     capabilities: ['weather.current', 'weather.forecast']\n *   },\n *   schema: {\n *     input: {\n *       city: stringField().required().minLength(2).description('City name').build()\n *     },\n *     config: {\n *       apiKey: apiKeyField().required().envVar('WEATHER_API_KEY').build()\n *     }\n *   },\n *   execute: async (input, config, context) => {\n *     // Tool implementation\n *     return { status: 'success', data: { temperature: 22 } };\n *   }\n * };\n * ```\n */\nexport interface CreateToolOptions<\n  TInput extends ToolInput = ToolInput,\n  TConfig extends ToolConfig = ToolConfig,\n> {\n  /** Tool metadata including name, version, description, and capabilities */\n  metadata: ToolMetadata;\n\n  /** Input and configuration validation schema */\n  schema: ToolSchema;\n\n  /** Main tool execution function */\n  execute: (\n    input: TInput,\n    config: TConfig,\n    context: ToolExecutionContext\n  ) => Promise<ToolExecutionResult>;\n\n  /** Optional setup function called when tool configuration is set */\n  setup?: (config: TConfig) => Promise<void>;\n\n  /** Optional cleanup function called when tool is stopped */\n  cleanup?: () => Promise<void>;\n\n  /** Optional health check function for monitoring */\n  healthCheck?: () => Promise<{\n    status: 'healthy' | 'unhealthy' | 'degraded';\n    details?: Record<string, any>;\n  }>;\n}\n\n/**\n * Creates a new AI Spine tool with comprehensive type safety, validation, and lifecycle management.\n * This is the primary factory function for creating tools that can be used by AI agents.\n *\n * Key features:\n * - Type-safe generics for input and configuration\n * - Comprehensive validation of tool definition\n * - Intelligent defaults for common patterns\n * - Plugin integration points for extensibility\n * - Developer experience optimizations\n *\n * @template TInput - The input data type for the tool (inferred from schema)\n * @template TConfig - The configuration type for the tool (inferred from schema)\n *\n * @param options - Complete tool configuration options\n * @returns A fully configured Tool instance ready to be started\n *\n * @throws {ConfigurationError} When tool definition is invalid\n * @throws {ValidationError} When schema validation fails\n *\n * @example\n * ```typescript\n * // Create a weather tool with type safety\n * const weatherTool = createTool({\n *   metadata: {\n *     name: 'weather-tool',\n *     version: '1.0.0',\n *     description: 'Fetches current weather data for any city',\n *     capabilities: ['weather.current', 'weather.forecast'],\n *     author: 'Your Name',\n *     tags: ['weather', 'api']\n *   },\n *   schema: {\n *     input: {\n *       city: stringField({\n *         required: true,\n *         description: 'Name of the city to get weather for',\n *         minLength: 2,\n *         maxLength: 100,\n *         example: 'Madrid'\n *       }),\n *       units: {\n *         type: 'enum',\n *         required: false,\n *         description: 'Temperature units',\n *         enum: ['celsius', 'fahrenheit', 'kelvin'],\n *         default: 'celsius'\n *       }\n *     },\n *     config: {\n *       apiKey: {\n *         type: 'apiKey',\n *         required: true,\n *         description: 'OpenWeatherMap API key',\n *         secret: true,\n *         envVar: 'OPENWEATHER_API_KEY'\n *       },\n *       baseUrl: {\n *         type: 'url',\n *         required: false,\n *         description: 'Base URL for the weather API',\n *         default: 'https://api.openweathermap.org/data/2.5'\n *       }\n *     }\n *   },\n *   execute: async (input, config, context) => {\n *     // Tool implementation with full type safety\n *     const response = await fetch(\n *       `${config.baseUrl}/weather?q=${input.city}&appid=${config.apiKey}&units=${input.units || 'celsius'}`\n *     );\n *\n *     if (!response.ok) {\n *       return {\n *         status: 'error',\n *         error: {\n *           code: 'API_ERROR',\n *           message: 'Failed to fetch weather data',\n *           type: 'network_error',\n *           retryable: true\n *         }\n *       };\n *     }\n *\n *     const data = await response.json();\n *\n *     return {\n *       status: 'success',\n *       data: {\n *         city: data.name,\n *         temperature: data.main.temp,\n *         description: data.weather[0].description,\n *         humidity: data.main.humidity,\n *         pressure: data.main.pressure\n *       },\n *       timing: {\n *         executionTimeMs: Date.now() - context.performance!.startTime,\n *         startedAt: new Date(context.performance!.startTime).toISOString(),\n *         completedAt: new Date().toISOString()\n *       }\n *     };\n *   },\n *   setup: async (config) => {\n *     // Validate API key by making a test request\n *     console.log('Validating weather API configuration...');\n *   },\n *   cleanup: async () => {\n *     console.log('Weather tool cleanup completed');\n *   },\n *   healthCheck: async () => {\n *     // Custom health check implementation\n *     return { status: 'healthy', details: { api: 'connected' } };\n *   }\n * });\n *\n * // Start the tool server\n * await weatherTool.start({\n *   port: 3000,\n *   security: {\n *     apiKeys: ['your-client-api-key'],\n *     requireAuth: true\n *   }\n * });\n * ```\n */\nexport function createTool<\n  TInput extends ToolInput = ToolInput,\n  TConfig extends ToolConfig = ToolConfig,\n>(options: CreateToolOptions<TInput, TConfig>): Tool<TInput, TConfig> {\n  // Step 1: Comprehensive validation of tool definition\n  validateToolDefinition(options);\n\n  // Step 2: Apply intelligent defaults and enhancements\n  const enhancedOptions = applyIntelligentDefaults(options);\n\n  // Step 3: Validate schema structure and field definitions\n  validateSchemaStructure(enhancedOptions.schema);\n\n  // Step 4: Create the complete tool definition\n  const definition: ToolDefinition<TInput, TConfig> = {\n    metadata: enhancedOptions.metadata,\n    schema: enhancedOptions.schema,\n    execute: enhancedOptions.execute,\n    setup: enhancedOptions.setup,\n    cleanup: enhancedOptions.cleanup,\n    healthCheck: enhancedOptions.healthCheck,\n  };\n\n  // Step 5: Create and return the tool instance\n  const tool = new Tool<TInput, TConfig>(definition);\n\n  // Step 6: Add development mode enhancements\n  if (\n    process.env.NODE_ENV === 'development' ||\n    process.env.AI_SPINE_DEBUG === 'true'\n  ) {\n    addDevelopmentEnhancements(tool, definition);\n  }\n\n  return tool;\n}\n\n/**\n * Advanced fluent API for creating tools with step-by-step configuration.\n * This class provides a builder pattern that enables incremental tool construction\n * with comprehensive validation and intelligent defaults.\n *\n * @template TInput - The input data type for the tool\n * @template TConfig - The configuration type for the tool\n *\n * @example\n * ```typescript\n * const tool = new ToolBuilder<WeatherInput, WeatherConfig>()\n *   .metadata({\n *     name: 'weather-tool',\n *     version: '1.0.0',\n *     description: 'Get weather information',\n *     capabilities: ['weather.current']\n *   })\n *   .inputField('city', stringField({ required: true, description: 'City name' }))\n *   .inputField('units', {\n *     type: 'enum',\n *     required: false,\n *     enum: ['celsius', 'fahrenheit'],\n *     default: 'celsius'\n *   })\n *   .configField('apiKey', apiKeyField({ required: true, envVar: 'WEATHER_API_KEY' }))\n *   .execute(async (input, config, context) => {\n *     // Implementation here\n *     return { status: 'success', data: { temperature: 22 } };\n *   })\n *   .onSetup(async (config) => {\n *     console.log('Setting up weather tool...');\n *   })\n *   .build();\n *\n * await tool.start({ port: 3000 });\n * ```\n */\nexport class ToolBuilder<\n  TInput extends ToolInput = ToolInput,\n  TConfig extends ToolConfig = ToolConfig,\n> {\n  private _metadata?: ToolMetadata;\n  private _inputSchema: Record<string, ToolInputField> = {};\n  private _configSchema: Record<string, ToolConfigField> = {};\n  private _executeFunction?: (\n    input: TInput,\n    config: TConfig,\n    context: ToolExecutionContext\n  ) => Promise<ToolExecutionResult>;\n  private _setupFunction?: (config: TConfig) => Promise<void>;\n  private _cleanupFunction?: () => Promise<void>;\n  private _healthCheckFunction?: () => Promise<{\n    status: 'healthy' | 'unhealthy' | 'degraded';\n    details?: Record<string, any>;\n  }>;\n  private _validationErrors: string[] = [];\n  private _built = false;\n\n  /**\n   * Set comprehensive tool metadata with validation.\n   *\n   * @param metadata - Complete metadata object\n   * @returns This builder instance for chaining\n   *\n   * @example\n   * ```typescript\n   * .metadata({\n   *   name: 'weather-tool',\n   *   version: '1.0.0',\n   *   description: 'Get current weather data',\n   *   capabilities: ['weather.current', 'weather.forecast'],\n   *   author: 'Your Name',\n   *   license: 'MIT',\n   *   tags: ['weather', 'api', 'external-service']\n   * })\n   * ```\n   */\n  metadata(metadata: ToolMetadata): ToolBuilder<TInput, TConfig> {\n    this.validateBuilderState();\n\n    // Validate metadata structure\n    if (!metadata.name || typeof metadata.name !== 'string') {\n      this._validationErrors.push(\n        'Tool name is required and must be a non-empty string'\n      );\n    }\n\n    if (!metadata.version || typeof metadata.version !== 'string') {\n      this._validationErrors.push(\n        'Tool version is required and must be a valid semver string'\n      );\n    }\n\n    if (!metadata.description || typeof metadata.description !== 'string') {\n      this._validationErrors.push(\n        'Tool description is required and must be a non-empty string'\n      );\n    }\n\n    if (\n      !Array.isArray(metadata.capabilities) ||\n      metadata.capabilities.length === 0\n    ) {\n      this._validationErrors.push(\n        'Tool capabilities must be a non-empty array'\n      );\n    }\n\n    this._metadata = metadata;\n    return this;\n  }\n\n  /**\n   * Define multiple input fields at once.\n   *\n   * @param schema - Input schema definition\n   * @returns This builder instance for chaining\n   *\n   * @example\n   * ```typescript\n   * .input({\n   *   city: stringField({ required: true, description: 'City name' }),\n   *   country: stringField({ required: false, description: 'Country code' }),\n   *   units: {\n   *     type: 'enum',\n   *     required: false,\n   *     enum: ['celsius', 'fahrenheit'],\n   *     default: 'celsius'\n   *   }\n   * })\n   * ```\n   */\n  input(schema: Record<string, ToolInputField>): ToolBuilder<TInput, TConfig> {\n    this.validateBuilderState();\n\n    if (!schema || typeof schema !== 'object') {\n      this._validationErrors.push('Input schema must be an object');\n    } else {\n      // Validate each field\n      Object.entries(schema).forEach(([name, field]) => {\n        if (!/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(name)) {\n          this._validationErrors.push(\n            `Input field name '${name}' must be a valid identifier`\n          );\n        }\n        if (!field || typeof field !== 'object') {\n          this._validationErrors.push(\n            `Input field '${name}' must be a valid field definition`\n          );\n        }\n      });\n    }\n\n    this._inputSchema = { ...this._inputSchema, ...schema };\n    return this;\n  }\n\n  /**\n   * Add a single input field with validation.\n   *\n   * @param name - Field name\n   * @param field - Field definition\n   * @returns This builder instance for chaining\n   *\n   * @example\n   * ```typescript\n   * .inputField('city', stringField({\n   *   required: true,\n   *   description: 'Name of the city',\n   *   minLength: 2,\n   *   example: 'Madrid'\n   * }))\n   * .inputField('units', {\n   *   type: 'enum',\n   *   required: false,\n   *   enum: ['celsius', 'fahrenheit'],\n   *   default: 'celsius'\n   * })\n   * ```\n   */\n  inputField(\n    name: string,\n    field: ToolInputField\n  ): ToolBuilder<TInput, TConfig> {\n    this.validateBuilderState();\n\n    if (!name || typeof name !== 'string' || name.trim().length === 0) {\n      this._validationErrors.push(\n        'Input field name must be a non-empty string'\n      );\n    } else if (!/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(name)) {\n      this._validationErrors.push(\n        `Input field name '${name}' must be a valid identifier (letters, numbers, underscores only)`\n      );\n    }\n\n    if (!field || typeof field !== 'object') {\n      this._validationErrors.push(\n        `Input field '${name}' must be a valid field definition object`\n      );\n    }\n\n    this._inputSchema[name] = field;\n    return this;\n  }\n\n  /**\n   * Define multiple configuration fields at once.\n   *\n   * @param schema - Configuration schema definition\n   * @returns This builder instance for chaining\n   *\n   * @example\n   * ```typescript\n   * .config({\n   *   apiKey: apiKeyField({ required: true, envVar: 'API_KEY' }),\n   *   baseUrl: configStringField({\n   *     required: false,\n   *     default: 'https://api.example.com',\n   *     description: 'API base URL'\n   *   }),\n   *   timeout: configNumberField({ required: false, default: 5000 })\n   * })\n   * ```\n   */\n  config(\n    schema: Record<string, ToolConfigField>\n  ): ToolBuilder<TInput, TConfig> {\n    this.validateBuilderState();\n\n    if (!schema || typeof schema !== 'object') {\n      this._validationErrors.push('Config schema must be an object');\n    } else {\n      // Validate each field\n      Object.entries(schema).forEach(([name, field]) => {\n        if (!/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(name)) {\n          this._validationErrors.push(\n            `Config field name '${name}' must be a valid identifier`\n          );\n        }\n        if (!field || typeof field !== 'object') {\n          this._validationErrors.push(\n            `Config field '${name}' must be a valid field definition`\n          );\n        }\n      });\n    }\n\n    this._configSchema = { ...this._configSchema, ...schema };\n    return this;\n  }\n\n  /**\n   * Add a single configuration field with validation.\n   *\n   * @param name - Field name\n   * @param field - Field definition\n   * @returns This builder instance for chaining\n   *\n   * @example\n   * ```typescript\n   * .configField('apiKey', apiKeyField({\n   *   required: true,\n   *   envVar: 'WEATHER_API_KEY',\n   *   description: 'OpenWeatherMap API key'\n   * }))\n   * .configField('timeout', configNumberField({\n   *   required: false,\n   *   default: 5000,\n   *   description: 'Request timeout in milliseconds'\n   * }))\n   * ```\n   */\n  configField(\n    name: string,\n    field: ToolConfigField\n  ): ToolBuilder<TInput, TConfig> {\n    this.validateBuilderState();\n\n    if (!name || typeof name !== 'string' || name.trim().length === 0) {\n      this._validationErrors.push(\n        'Config field name must be a non-empty string'\n      );\n    } else if (!/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(name)) {\n      this._validationErrors.push(\n        `Config field name '${name}' must be a valid identifier (letters, numbers, underscores only)`\n      );\n    }\n\n    if (!field || typeof field !== 'object') {\n      this._validationErrors.push(\n        `Config field '${name}' must be a valid field definition object`\n      );\n    }\n\n    this._configSchema[name] = field;\n    return this;\n  }\n\n  /**\n   * Set the main tool execution function with comprehensive type safety.\n   *\n   * @param fn - Tool execution function\n   * @returns This builder instance for chaining\n   *\n   * @example\n   * ```typescript\n   * .execute(async (input, config, context) => {\n   *   // Validate input\n   *   if (!input.city) {\n   *     return {\n   *       status: 'error',\n   *       error: {\n   *         code: 'MISSING_CITY',\n   *         message: 'City parameter is required',\n   *         type: 'validation_error'\n   *       }\n   *     };\n   *   }\n   *\n   *   // Execute tool logic\n   *   const weatherData = await getWeatherData(input.city, config.apiKey);\n   *\n   *   // Return structured result\n   *   return {\n   *     status: 'success',\n   *     data: weatherData,\n   *     timing: {\n   *       executionTimeMs: Date.now() - context.performance!.startTime,\n   *       startedAt: new Date(context.performance!.startTime).toISOString(),\n   *       completedAt: new Date().toISOString()\n   *     }\n   *   };\n   * })\n   * ```\n   */\n  execute(\n    fn: (\n      input: TInput,\n      config: TConfig,\n      context: ToolExecutionContext\n    ) => Promise<ToolExecutionResult>\n  ): ToolBuilder<TInput, TConfig> {\n    this.validateBuilderState();\n\n    if (typeof fn !== 'function') {\n      this._validationErrors.push('Execute function must be a valid function');\n    }\n\n    this._executeFunction = fn;\n    return this;\n  }\n\n  /**\n   * Set configuration setup function called when tool is initialized.\n   *\n   * @param fn - Setup function\n   * @returns This builder instance for chaining\n   *\n   * @example\n   * ```typescript\n   * .onSetup(async (config) => {\n   *   // Validate API connectivity\n   *   await validateApiKey(config.apiKey);\n   *\n   *   // Initialize connections\n   *   await initializeCache();\n   *\n   *   console.log('Tool setup completed successfully');\n   * })\n   * ```\n   */\n  onSetup(\n    fn: (config: TConfig) => Promise<void>\n  ): ToolBuilder<TInput, TConfig> {\n    this.validateBuilderState();\n\n    if (typeof fn !== 'function') {\n      this._validationErrors.push('Setup function must be a valid function');\n    }\n\n    this._setupFunction = fn;\n    return this;\n  }\n\n  /**\n   * Set cleanup function called when tool is stopped.\n   *\n   * @param fn - Cleanup function\n   * @returns This builder instance for chaining\n   *\n   * @example\n   * ```typescript\n   * .onCleanup(async () => {\n   *   // Close database connections\n   *   await db.close();\n   *\n   *   // Clear caches\n   *   cache.clear();\n   *\n   *   // Log cleanup completion\n   *   console.log('Tool cleanup completed');\n   * })\n   * ```\n   */\n  onCleanup(fn: () => Promise<void>): ToolBuilder<TInput, TConfig> {\n    this.validateBuilderState();\n\n    if (typeof fn !== 'function') {\n      this._validationErrors.push('Cleanup function must be a valid function');\n    }\n\n    this._cleanupFunction = fn;\n    return this;\n  }\n\n  /**\n   * Set custom health check function for monitoring.\n   *\n   * @param fn - Health check function\n   * @returns This builder instance for chaining\n   *\n   * @example\n   * ```typescript\n   * .healthCheck(async () => {\n   *   try {\n   *     // Check database connectivity\n   *     await db.ping();\n   *\n   *     // Check external API\n   *     const apiStatus = await checkExternalApi();\n   *\n   *     return {\n   *       status: 'healthy',\n   *       details: {\n   *         database: 'connected',\n   *         externalApi: apiStatus\n   *       }\n   *     };\n   *   } catch (error) {\n   *     return {\n   *       status: 'unhealthy',\n   *       details: { error: error.message }\n   *     };\n   *   }\n   * })\n   * ```\n   */\n  healthCheck(\n    fn: () => Promise<{\n      status: 'healthy' | 'unhealthy' | 'degraded';\n      details?: Record<string, any>;\n    }>\n  ): ToolBuilder<TInput, TConfig> {\n    this.validateBuilderState();\n\n    if (typeof fn !== 'function') {\n      this._validationErrors.push(\n        'Health check function must be a valid function'\n      );\n    }\n\n    this._healthCheckFunction = fn;\n    return this;\n  }\n\n  /**\n   * Validates that the builder hasn't been used yet and can accept more configuration.\n   * @private\n   */\n  private validateBuilderState(): void {\n    if (this._built) {\n      throw new ConfigurationError(\n        'ToolBuilder has already been built and cannot be modified. Create a new builder instance.'\n      );\n    }\n  }\n\n  /**\n   * Build the tool with comprehensive validation and error reporting.\n   *\n   * @returns A fully configured Tool instance\n   * @throws {ConfigurationError} When builder configuration is invalid\n   *\n   * @example\n   * ```typescript\n   * const tool = builder.build();\n   * await tool.start({ port: 3000 });\n   * ```\n   */\n  build(): Tool<TInput, TConfig> {\n    // Prevent multiple builds from same instance\n    if (this._built) {\n      throw new ConfigurationError(\n        'ToolBuilder has already been built. Create a new builder instance for a new tool.'\n      );\n    }\n\n    // Validate required components\n    if (!this._metadata) {\n      this._validationErrors.push(\n        'Tool metadata is required. Call .metadata() with tool information.'\n      );\n    }\n\n    if (!this._executeFunction) {\n      this._validationErrors.push(\n        'Execute function is required. Call .execute() with your tool logic.'\n      );\n    }\n\n    // Report all validation errors at once\n    if (this._validationErrors.length > 0) {\n      throw new ConfigurationError(\n        `Tool configuration validation failed:\\n${this._validationErrors.map(e => `  - ${e}`).join('\\n')}`,\n        this._validationErrors\n      );\n    }\n\n    // Create the tool options\n    const options: CreateToolOptions<TInput, TConfig> = {\n      metadata: this._metadata!,\n      schema: {\n        input: this._inputSchema,\n        config: this._configSchema,\n      },\n      execute: this._executeFunction!,\n      setup: this._setupFunction,\n      cleanup: this._cleanupFunction,\n      healthCheck: this._healthCheckFunction,\n    };\n\n    // Mark as built to prevent reuse\n    this._built = true;\n\n    // Create and return the tool\n    return createTool(options);\n  }\n\n  /**\n   * Get current validation errors without building.\n   * Useful for debugging configuration issues.\n   *\n   * @returns Array of validation error messages\n   */\n  getValidationErrors(): string[] {\n    const errors = [...this._validationErrors];\n\n    if (!this._metadata) {\n      errors.push('Tool metadata is required');\n    }\n\n    if (!this._executeFunction) {\n      errors.push('Execute function is required');\n    }\n\n    return errors;\n  }\n\n  /**\n   * Check if the builder configuration is valid without building.\n   *\n   * @returns True if configuration is valid, false otherwise\n   */\n  isValid(): boolean {\n    return this.getValidationErrors().length === 0;\n  }\n}\n\n// ============================================================================\n// FIELD BUILDER FUNCTIONS\n// These functions provide a convenient API for creating field definitions\n// with proper defaults and validation.\n// ============================================================================\n\n/**\n * Creates a string input field with comprehensive validation options.\n *\n * @param options - Field configuration options\n * @returns Configured string field definition\n *\n * @example\n * ```typescript\n * // Simple required string\n * city: stringField({ required: true, description: 'City name' })\n *\n * // String with validation\n * email: stringField({\n *   required: true,\n *   format: 'email',\n *   description: 'User email address',\n *   example: 'user@example.com'\n * })\n *\n * // String with length constraints\n * name: stringField({\n *   required: true,\n *   minLength: 2,\n *   maxLength: 50,\n *   description: 'User name'\n * })\n * ```\n */\nexport function stringField(\n  options: Partial<ToolInputField> = {}\n): ToolInputField {\n  return {\n    type: 'string',\n    required: options.required ?? false,\n    ...options,\n  };\n}\n\n/**\n * Creates a number input field with validation options.\n *\n * @param options - Field configuration options\n * @returns Configured number field definition\n *\n * @example\n * ```typescript\n * temperature: numberField({\n *   required: true,\n *   min: -100,\n *   max: 100,\n *   description: 'Temperature in celsius'\n * })\n * ```\n */\nexport function numberField(\n  options: Partial<ToolInputField> = {}\n): ToolInputField {\n  return {\n    type: 'number',\n    required: options.required ?? false,\n    ...options,\n  };\n}\n\n/**\n * Creates a boolean input field.\n *\n * @param options - Field configuration options\n * @returns Configured boolean field definition\n *\n * @example\n * ```typescript\n * includeDetails: booleanField({\n *   required: false,\n *   default: false,\n *   description: 'Include detailed information'\n * })\n * ```\n */\nexport function booleanField(\n  options: Partial<ToolInputField> = {}\n): ToolInputField {\n  return {\n    type: 'boolean',\n    required: options.required ?? false,\n    ...options,\n  };\n}\n\n/**\n * Creates an array input field with item type validation.\n *\n * @param items - Definition for array items\n * @param options - Field configuration options\n * @returns Configured array field definition\n *\n * @example\n * ```typescript\n * tags: arrayField(\n *   stringField({ minLength: 1, maxLength: 20 }),\n *   {\n *     required: false,\n *     minItems: 0,\n *     maxItems: 10,\n *     uniqueItems: true,\n *     description: 'List of tags'\n *   }\n * )\n * ```\n */\nexport function arrayField(\n  items: ToolInputField,\n  options: Partial<ToolInputField> = {}\n): ToolInputField {\n  return {\n    type: 'array',\n    required: options.required ?? false,\n    items,\n    ...options,\n  };\n}\n\n/**\n * Creates an object input field with property definitions.\n *\n * @param properties - Object property definitions\n * @param options - Field configuration options\n * @returns Configured object field definition\n *\n * @example\n * ```typescript\n * location: objectField(\n *   {\n *     latitude: numberField({ required: true, min: -90, max: 90 }),\n *     longitude: numberField({ required: true, min: -180, max: 180 })\n *   },\n *   {\n *     required: true,\n *     description: 'Geographic coordinates'\n *   }\n * )\n * ```\n */\nexport function objectField(\n  properties: Record<string, ToolInputField>,\n  options: Partial<ToolInputField> = {}\n): ToolInputField {\n  return {\n    type: 'object',\n    required: options.required ?? false,\n    properties,\n    ...options,\n  };\n}\n\n/**\n * Creates a date input field with format validation.\n *\n * @param options - Field configuration options\n * @returns Configured date field definition\n *\n * @example\n * ```typescript\n * birthDate: dateField({\n *   required: true,\n *   description: 'Date of birth',\n *   minDate: '1900-01-01',\n *   maxDate: '2023-12-31'\n * })\n * ```\n */\nexport function dateField(\n  options: Partial<ToolInputField> = {}\n): ToolInputField {\n  return {\n    type: 'date',\n    required: options.required ?? false,\n    ...options,\n  };\n}\n\n/**\n * Creates a time input field with format validation.\n *\n * @param options - Field configuration options\n * @returns Configured time field definition\n *\n * @example\n * ```typescript\n * meetingTime: timeField({\n *   required: true,\n *   description: 'Meeting time',\n *   example: '14:30'\n * })\n * ```\n */\nexport function timeField(\n  options: Partial<ToolInputField> = {}\n): ToolInputField {\n  return {\n    type: 'time',\n    required: options.required ?? false,\n    ...options,\n  };\n}\n\n/**\n * Creates an enum input field with predefined values.\n *\n * @param values - Array of allowed values\n * @param options - Field configuration options\n * @returns Configured enum field definition\n *\n * @example\n * ```typescript\n * priority: enumField(\n *   ['low', 'medium', 'high', 'critical'],\n *   {\n *     required: false,\n *     default: 'medium',\n *     description: 'Task priority level'\n *   }\n * )\n * ```\n */\nexport function enumField(\n  values: any[],\n  options: Partial<ToolInputField> = {}\n): ToolInputField {\n  return {\n    type: 'enum',\n    required: options.required ?? false,\n    enum: values,\n    ...options,\n  };\n}\n\n/**\n * Creates an API key configuration field with security best practices.\n *\n * @param options - Field configuration options\n * @returns Configured API key field definition\n *\n * @example\n * ```typescript\n * // Basic API key\n * apiKey: apiKeyField({ required: true, envVar: 'MY_API_KEY' })\n *\n * // API key with validation pattern\n * githubToken: apiKeyField({\n *   required: true,\n *   envVar: 'GITHUB_TOKEN',\n *   description: 'GitHub personal access token',\n *   validation: {\n *     pattern: '^ghp_[a-zA-Z0-9]{36}$',\n *     errorMessage: 'GitHub token must start with \"ghp_\" and be 40 characters total'\n *   }\n * })\n * ```\n */\nexport function apiKeyField(\n  options: Partial<ToolConfigField> = {}\n): ToolConfigField {\n  return {\n    type: 'apiKey',\n    required: options.required ?? true,\n    secret: true,\n    description: options.description || 'API key for authentication',\n    ...options,\n  };\n}\n\n/**\n * Creates a configuration string field.\n *\n * @param options - Field configuration options\n * @returns Configured string config field definition\n *\n * @example\n * ```typescript\n * baseUrl: configStringField({\n *   required: false,\n *   default: 'https://api.example.com',\n *   description: 'Base URL for API requests',\n *   validation: { pattern: '^https://.+' }\n * })\n * ```\n */\nexport function configStringField(\n  options: Partial<ToolConfigField> = {}\n): ToolConfigField {\n  return {\n    type: 'string',\n    required: options.required ?? false,\n    ...options,\n  };\n}\n\n/**\n * Creates a configuration number field.\n *\n * @param options - Field configuration options\n * @returns Configured number config field definition\n *\n * @example\n * ```typescript\n * timeout: configNumberField({\n *   required: false,\n *   default: 5000,\n *   description: 'Request timeout in milliseconds',\n *   validation: { min: 1000, max: 30000 }\n * })\n * ```\n */\nexport function configNumberField(\n  options: Partial<ToolConfigField> = {}\n): ToolConfigField {\n  return {\n    type: 'number',\n    required: options.required ?? false,\n    ...options,\n  };\n}\n\n/**\n * Creates a URL configuration field with validation.\n *\n * @param options - Field configuration options\n * @returns Configured URL config field definition\n *\n * @example\n * ```typescript\n * webhookUrl: configUrlField({\n *   required: true,\n *   description: 'Webhook endpoint URL',\n *   validation: { allowedProtocols: ['https'] }\n * })\n * ```\n */\nexport function configUrlField(\n  options: Partial<ToolConfigField> = {}\n): ToolConfigField {\n  return {\n    type: 'url',\n    required: options.required ?? false,\n    validation: {\n      allowedProtocols: ['https', 'http'],\n      ...options.validation,\n    },\n    ...options,\n  };\n}\n\n/**\n * Comprehensive validation of tool definition for completeness, correctness, and best practices.\n * This function ensures that all required fields are present and properly formatted.\n *\n * @param options - Tool configuration options to validate\n * @throws {ConfigurationError} When validation fails\n * @private\n */\nfunction validateToolDefinition<\n  TInput extends ToolInput,\n  TConfig extends ToolConfig,\n>(options: CreateToolOptions<TInput, TConfig>): void {\n  const errors: string[] = [];\n  const warnings: string[] = [];\n\n  // Comprehensive metadata validation\n  if (!options.metadata) {\n    errors.push('Tool metadata is required');\n  } else {\n    const meta = options.metadata;\n\n    // Required fields validation\n    if (\n      !meta.name ||\n      typeof meta.name !== 'string' ||\n      meta.name.trim().length === 0\n    ) {\n      errors.push('Tool name is required and must be a non-empty string');\n    } else if (!/^[a-z0-9-]+$/.test(meta.name)) {\n      warnings.push(\n        'Tool name should use kebab-case format (lowercase with hyphens)'\n      );\n    }\n\n    if (\n      !meta.version ||\n      typeof meta.version !== 'string' ||\n      meta.version.trim().length === 0\n    ) {\n      errors.push('Tool version is required and must be a non-empty string');\n    } else if (!/^\\d+\\.\\d+\\.\\d+/.test(meta.version)) {\n      warnings.push(\n        'Tool version should follow semantic versioning (e.g., \"1.0.0\")'\n      );\n    }\n\n    if (\n      !meta.description ||\n      typeof meta.description !== 'string' ||\n      meta.description.trim().length === 0\n    ) {\n      errors.push(\n        'Tool description is required and must be a non-empty string'\n      );\n    } else if (meta.description.length < 10) {\n      warnings.push(\n        'Tool description should be descriptive (at least 10 characters)'\n      );\n    }\n\n    if (!Array.isArray(meta.capabilities) || meta.capabilities.length === 0) {\n      errors.push('Tool capabilities must be a non-empty array');\n    } else {\n      // Validate capability strings\n      meta.capabilities.forEach((cap, index) => {\n        if (typeof cap !== 'string' || cap.trim().length === 0) {\n          errors.push(\n            `Capability at index ${index} must be a non-empty string`\n          );\n        }\n      });\n    }\n\n    // Optional fields validation\n    if (meta.author && typeof meta.author !== 'string') {\n      errors.push('Tool author must be a string if provided');\n    }\n\n    if (meta.license && typeof meta.license !== 'string') {\n      errors.push('Tool license must be a string if provided');\n    }\n\n    if (meta.tags && !Array.isArray(meta.tags)) {\n      errors.push('Tool tags must be an array if provided');\n    }\n  }\n\n  // Schema structure validation\n  if (!options.schema) {\n    errors.push('Tool schema is required');\n  } else {\n    const schema = options.schema;\n\n    if (!schema.input || typeof schema.input !== 'object') {\n      errors.push('Input schema is required and must be an object');\n    }\n\n    if (!schema.config || typeof schema.config !== 'object') {\n      errors.push('Config schema is required and must be an object');\n    }\n  }\n\n  // Execute function validation\n  if (!options.execute || typeof options.execute !== 'function') {\n    errors.push('Execute function is required and must be a function');\n  } else {\n    // Check function signature (approximate)\n    const funcStr = options.execute.toString();\n    if (funcStr.includes('function') && options.execute.length < 3) {\n      warnings.push(\n        'Execute function should accept three parameters: (input, config, context)'\n      );\n    }\n  }\n\n  // Optional function validations\n  if (options.setup && typeof options.setup !== 'function') {\n    errors.push('Setup function must be a function if provided');\n  }\n\n  if (options.cleanup && typeof options.cleanup !== 'function') {\n    errors.push('Cleanup function must be a function if provided');\n  }\n\n  if (options.healthCheck && typeof options.healthCheck !== 'function') {\n    errors.push('Health check function must be a function if provided');\n  }\n\n  // Report errors\n  if (errors.length > 0) {\n    throw new ConfigurationError(\n      `Tool definition validation failed:\\n${errors.map(e => `  ‚ùå ${e}`).join('\\n')}${\n        warnings.length > 0\n          ? `\\n\\nWarnings:\\n${warnings.map(w => `  ‚ö†Ô∏è  ${w}`).join('\\n')}`\n          : ''\n      }`,\n      errors\n    );\n  }\n\n  // Log warnings in development\n  if (\n    warnings.length > 0 &&\n    (process.env.NODE_ENV === 'development' ||\n      process.env.AI_SPINE_DEBUG === 'true')\n  ) {\n    console.warn(\n      `\\n‚ö†Ô∏è  Tool Definition Warnings for \"${options.metadata.name}\":\\n${warnings.map(w => `  ‚Ä¢ ${w}`).join('\\n')}\\n`\n    );\n  }\n}\n\n/**\n * Applies intelligent defaults and enhancements to tool options.\n * This function improves developer experience by setting reasonable defaults.\n *\n * @param options - Original tool options\n * @returns Enhanced options with intelligent defaults\n * @private\n */\nfunction applyIntelligentDefaults<\n  TInput extends ToolInput,\n  TConfig extends ToolConfig,\n>(\n  options: CreateToolOptions<TInput, TConfig>\n): CreateToolOptions<TInput, TConfig> {\n  const enhanced = { ...options };\n\n  // Enhance metadata with defaults\n  if (!enhanced.metadata.tags) {\n    enhanced.metadata.tags = [];\n  }\n\n  // Add SDK version if not specified\n  if (!enhanced.metadata.minSdkVersion) {\n    enhanced.metadata.minSdkVersion = '1.0.0';\n  }\n\n  // Ensure schema has proper structure\n  if (!enhanced.schema.input) {\n    enhanced.schema.input = {};\n  }\n\n  if (!enhanced.schema.config) {\n    enhanced.schema.config = {};\n  }\n\n  return enhanced;\n}\n\n/**\n * Validates schema structure and field definitions for correctness.\n *\n * @param schema - Tool schema to validate\n * @throws {ValidationError} When schema validation fails\n * @private\n */\nfunction validateSchemaStructure(schema: ToolSchema): void {\n  const errors: string[] = [];\n\n  // Validate input fields\n  if (schema.input) {\n    Object.entries(schema.input).forEach(([fieldName, field]) => {\n      if (!field.type) {\n        errors.push(`Input field '${fieldName}' must have a type`);\n      }\n\n      if (field.required === undefined) {\n        errors.push(`Input field '${fieldName}' must specify if it's required`);\n      }\n    });\n  }\n\n  // Validate config fields\n  if (schema.config) {\n    Object.entries(schema.config).forEach(([fieldName, field]) => {\n      if (!field.type) {\n        errors.push(`Config field '${fieldName}' must have a type`);\n      }\n\n      if (field.required === undefined) {\n        errors.push(\n          `Config field '${fieldName}' must specify if it's required`\n        );\n      }\n    });\n  }\n\n  if (errors.length > 0) {\n    throw new ValidationError(\n      `Schema validation failed:\\n${errors.map(e => `  ‚ùå ${e}`).join('\\n')}`\n    );\n  }\n}\n\n/**\n * Adds development mode enhancements to improve developer experience.\n *\n * @param tool - Tool instance to enhance\n * @param definition - Tool definition for context\n * @private\n */\nfunction addDevelopmentEnhancements<\n  TInput extends ToolInput,\n  TConfig extends ToolConfig,\n>(\n  tool: Tool<TInput, TConfig>,\n  definition: ToolDefinition<TInput, TConfig>\n): void {\n  // Add helpful logging\n  console.log(\n    `\\nüõ†Ô∏è  Created tool \"${definition.metadata.name}\" v${definition.metadata.version}`\n  );\n  console.log(`   üìù ${definition.metadata.description}`);\n  console.log(\n    `   üéØ Capabilities: ${definition.metadata.capabilities.join(', ')}`\n  );\n  console.log(\n    `   üìä Input fields: ${Object.keys(definition.schema.input).length}`\n  );\n  console.log(\n    `   ‚öôÔ∏è  Config fields: ${Object.keys(definition.schema.config).length}`\n  );\n\n  // Add development event listeners\n  tool.on('beforeExecution', context => {\n    console.log(\n      `üöÄ Executing tool \"${definition.metadata.name}\" (ID: ${context.executionId})`\n    );\n  });\n\n  tool.on('afterExecution', (_context, result) => {\n    const duration = result.timing?.executionTimeMs || 0;\n    const status = result.status === 'success' ? '‚úÖ' : '‚ùå';\n    console.log(`${status} Tool execution ${result.status} in ${duration}ms`);\n  });\n\n  tool.on('error', error => {\n    console.error(\n      `‚ùå Tool error in \"${definition.metadata.name}\":`,\n      error.message\n    );\n  });\n}\n\n// ============================================================================\n// CONVENIENCE FUNCTIONS\n// These functions provide shortcuts for common tool creation patterns.\n// ============================================================================\n\n/**\n * Creates a simple tool with minimal configuration for quick prototyping.\n *\n * @param name - Tool name\n * @param version - Tool version\n * @param description - Tool description\n * @param execute - Tool execution function\n * @returns Configured tool instance\n *\n * @example\n * ```typescript\n * const echoTool = simpleCreateTool(\n *   'echo-tool',\n *   '1.0.0',\n *   'Simple echo tool for testing',\n *   async (input) => {\n *     return {\n *       status: 'success',\n *       data: { echo: input }\n *     };\n *   }\n * );\n *\n * await echoTool.start({ port: 3000 });\n * ```\n */\nexport function simpleCreateTool<TInput extends ToolInput = ToolInput>(\n  name: string,\n  version: string,\n  description: string,\n  execute: (input: TInput) => Promise<any>\n): Tool<TInput, Record<string, never>> {\n  return createTool({\n    metadata: {\n      name,\n      version,\n      description,\n      capabilities: [name.replace(/-tool$/, '')],\n    },\n    schema: {\n      input: {},\n      config: {},\n    },\n    execute: async (input, _config, context) => {\n      try {\n        const result = await execute(input);\n        return {\n          status: 'success',\n          data: result,\n          timing: {\n            executionTimeMs: Date.now() - context.performance!.startTime,\n            startedAt: new Date(context.performance!.startTime).toISOString(),\n            completedAt: new Date().toISOString(),\n          },\n        };\n      } catch (error) {\n        return {\n          status: 'error',\n          error: {\n            code: 'EXECUTION_ERROR',\n            message: (error as Error).message,\n            type: 'execution_error',\n          },\n        };\n      }\n    },\n  });\n}\n\n/**\n * Creates a tool builder instance for fluent API usage.\n *\n * @returns New ToolBuilder instance\n *\n * @example\n * ```typescript\n * const tool = createToolBuilder()\n *   .metadata({ name: 'my-tool', version: '1.0.0', ... })\n *   .inputField('message', stringField({ required: true }))\n *   .execute(async (input, config, context) => ({ ... }))\n *   .build();\n * ```\n */\nexport function createToolBuilder<\n  TInput extends ToolInput = ToolInput,\n  TConfig extends ToolConfig = ToolConfig,\n>(): ToolBuilder<TInput, TConfig> {\n  return new ToolBuilder<TInput, TConfig>();\n}\n"],"names":["Tool","ConfigurationError","ValidationError"],"mappings":"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"}